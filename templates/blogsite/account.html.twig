{% extends 'base.html.twig' %}

{% block title %}Account{% endblock %}

{% block content %}
    <h1 class="text-2xl mb-10">
        Welcome {{ name }}
    </h1>

    <div class="flex-none w-32 h-32 rounded-full shadow-xl my-4">
        {% if avatar %}
            <img class="h-full w-full object-cover object-center rounded-full" src="{{ asset('uploads/avatar/image/' ~ avatar.filename) }}">
        {% else %}
            <img src="{{ asset('img/avatar/1.png') }}">
        {% endif %}
    </div>
    <div>
        {{ include('blogsite/_form.html.twig', {'button_label': 'Update'}) }}
    </div>


    <a href="{{ path('app_blog_new') }}"
       class="hover:text-amber-200"
    >
        <button class="bg-amber-600 text-white p-2 rounded-full m-2 mb-10">
            Create new blog
        </button>
    </a>

    <h2 class="text-xl mb-10">
        Your blogs
    </h2>

    <table class="w-full table-fixed border-2 border-black shadow-2xl mb-2">
        <tr class="bg-slate-600 text-white py-2">
            <th>Publish date</th>
            <th>Title</th>
            <th>Actions</th>
        </tr>

    {% for blog in blogs %}
        <tr class="{% if loop.index % 2 == 0 %} bg-slate-300 {% endif %} py-2">
            <td>
                {{ blog.publishDate ? blog.publishDate|date('Y-m-d H:i:s') : '' }}
            </td>
            <td>
                <a href="{{ path('app_blog_show', {'id': blog.id}) }}"
                   class="hover:text-amber-600"
                >
                    {{ blog.title }}
                </a>
            </td>
            <td>
                <div class="flex">
                    <a href="{{ path('app_blog_edit', {'id': blog.id}) }}"
                       class="hover:text-amber-600"
                    >
                        <button class="bg-sky-800 text-white p-2 rounded-xl m-2">
                            Edit
                        </button>
                    </a>
                    <a href="{{ path('app_blog_archive', {'id': blog.id}) }}"
                       class="hover:text-amber-600"
                    >
                        {% if blog.archived %}
                            <button class="bg-green-800 text-white p-2 rounded-xl m-2">
                                Republish
                            </button>

                        {% else %}
                            <button class="bg-yellow-800 text-white p-2 rounded-xl m-2">
                                Archive
                            </button>
                        {% endif %}
                    </a>
                    <form method="post"
                          action="{{ path('app_blog_delete', {'id': blog.id}) }}"
                          onsubmit="return confirm('Are you sure you want to delete this blog?');">
                        <input type="hidden" name="token" value="{{ csrf_token('delete-item') }}"/>
                        <button class="btn bg-red-800 text-white p-2 rounded-xl m-2">
                            Delete
                        </button>
                    </form>
                </div>

            </td>
        </tr>
    {% else %}
        <tr class="py-2">
            <td colspan="3">
                No blogs found
            </td>
        </tr>
    {% endfor %}
    </table>

    <h2 class="text-xl">
        Your Comments
    </h2>
    <table class="w-full table-fixed border-2 border-black shadow-2xl">
        <tr class="bg-slate-600 text-white py-2">
            <th>Author</th>
            <th>Title</th>
            <th>Your comment</th>
            <th>Actions</th>
        </tr>

        {% for commentary in commentaries %}
            <tr class="{% if loop.index % 2 == 0 %} bg-slate-300 {% endif %} py-2">
                <td>
                    {{ commentary.blog.user.getName() }}
                </td>
                <td>
                    <a href="{{ path('app_blog_show', {'id': commentary.blog.id}) }}"
                       class="hover:text-amber-600"
                    >
                        {{ commentary.blog.title }}
                    </a>
                </td>
                <td>
                    {{ commentary.text}}
                </td>
                <td>
                    <div class="flex">
                        <a href="{{ path('app_commentary_edit', {'id': commentary.id}) }}"
                           class="hover:text-amber-600"
                        >
                            <button class="bg-sky-800 text-white p-2 rounded-xl m-2">
                                Edit
                            </button>
                        </a>
                        <form method="post"
                              action="{{ path('app_commentary_delete', {'id': commentary.id}) }}"
                              onsubmit="return confirm('Are you sure you want to delete this comment?');">
                            <input type="hidden" name="token" value="{{ csrf_token('delete-item') }}"/>
                            <button class="btn bg-red-800 text-white p-2 rounded-xl m-2">
                                Delete
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
        {% else %}
            <tr class="py-2">
                <td colspan="3">
                    No comments found
                </td>
            </tr>
        {% endfor %}
    </table>
{% endblock %}
